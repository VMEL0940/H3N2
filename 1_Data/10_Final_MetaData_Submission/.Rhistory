ifelse(AllG_NS_V2$vaccineStrain == "EPI577969_A_Perth_16_2009" & AllG_NS_V2$vaccine_code == "Vic11", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI417234_A_Victoria_361_2011" & AllG_NS_V2$vaccine_code == "Swtz13", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI614441_A_Switzerland_9715293_2013" & AllG_NS_V2$vaccine_code == "HK15", "VP+1","VP"
))))))))
AllG_NS_V2$DomExtVac2_F <- factor(AllG_NS_V2$vaccine_period_Bi,
levels = c("VP","VP+1"), labels = c("Before update","After update"))
VP3Col <- c("#000000","#96fd29")
## Load dominant file
Dom <- read.csv("/Users/sangyi/Desktop/H3N2/1_Data/5_Regression/Dom.csv")
subdata <- Dom[,c(1,16)]
colnames(subdata)[1] <- "StrainName"
AllG_NS_V3 <- left_join(AllG_NS_V2, subdata, by = "StrainName")
AllG_NS_V3$DomExtVac2 <- ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 0, 0,
ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 1, 1, 2))
AllG_NS_V3$DomExtVac2_F <- factor(AllG_NS_V3$DomExtVac2,
levels = c(0,1,2),
labels = c("Extinct","Dominant","After Vaccine"))
VP3Col2 <- c("#000000","#96fd29","#999900")
### Fina box plot ###
#
# jpeg(filename = "C:/Users/KU_Microb_Virus/OneDrive - 고려대학교/RschProf_KU/01_GenDisFlu/Fig/Desc/NS_3VacPrd/Box_8gene.jpeg", width = 220, height = 200, units = "mm", res = 450)
# svg(filename = "Fig/Desc/NS_2VacPrd/gene_Dom_2nd.svg", width = 11, height = 10)
AllG_NS_V3 <- AllG_NS_V3[!is.na(AllG_NS_V3$Gene),]
AllG_NS_V3 %>%
ggplot() +
geom_jitter(aes(x= DomExtVac2_F, y= Nmedian), width = 0.25, size = 0.50, color = "gray40") +
geom_boxplot(aes(x= DomExtVac2_F, y = Nmedian, color = DomExtVac2_F), size = 1.1, outlier.shape = NA, alpha = 0) +
xlab("Dominance") +
ylab("Nonsynonymous genetic distance")+
facet_wrap( ~ Gene, nrow = 2, ncol = 4) +
scale_color_manual(values = VP3Col2, guide="none") +
theme_bw() +
theme(strip.background = element_rect(fill="white"),
strip.text.x = element_text(size = 10, face = "bold", family = "sans"))
### Influ H3N2 GenDist Proj ###
## Package ##
library(tidyverse)
library(factoextra)
library(FactoMineR)
library(ggpubr)
library(corrplot)
library(igraph)
library(Hmisc)
flattenCorrMatrix <- function(cormat, pmat) {
ut <- upper.tri(cormat)
data.frame(
row = rownames(cormat)[row(cormat)[ut]],
column = rownames(cormat)[col(cormat)[ut]],
cor  =(cormat)[ut],
p = pmat[ut]
)
}
## Set working directory ##
setwd("/Users/sangyi/Desktop/H3N2/1_Data/2_RNSC/3_DistanceLog/1_Before2020_601/Gs")
## Data import ##
G1_NS <- read.table("G1_NS_2.txt", header = T, na.strings = "")
G2_NS <- read.table("G2_NS_2.txt", header = T, na.strings = "")
G3_NS <- read.table("G3_NS_2.txt", header = T, na.strings = "")
G4_NS <- read.table("G4_NS_2.txt", header = T, na.strings = "")
G5_NS <- read.table("G5_NS_2.txt", header = T, na.strings = "")
G6_NS <- read.table("G6_NS_2.txt", header = T, na.strings = "")
G7_NS <- read.table("G7_NS_2.txt", header = T, na.strings = "")
G8_NS <- read.table("G8_NS_2.txt", header = T, na.strings = "")
G9_NS <- read.table("G9_NS_2.txt", header = T, na.strings = "")
G1_NS$Gene <- factor(G1_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G2_NS$Gene <- factor(G2_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G3_NS$Gene <- factor(G3_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G4_NS$Gene <- factor(G4_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G5_NS$Gene <- factor(G5_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G6_NS$Gene <- factor(G6_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G7_NS$Gene <- factor(G7_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G8_NS$Gene <- factor(G8_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
G9_NS$Gene <- factor(G9_NS$Gene, levels = c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
## combine all data
AllG_NS <- rbind(G1_NS, G2_NS, G3_NS, G4_NS, G5_NS,
G6_NS, G7_NS, G8_NS, G9_NS)
GeneCol <- c("#C780E8", "#9D94FF","#59ADF6","#08CAD1","#42D6A4","#F8F38D","#FFB480","#FF6961")
## Let's use Median!! ##
G2_NS <- G2_NS %>%
group_by(compareStrain, Gene) %>%
mutate(Nmedian = mean(N2, na.rm = TRUE))
G2_NS <- G2_NS %>% select(vaccineStrain, compareStrain, Gene, Nmedian) %>% unique
## Build Correlation matrix - G2##
N_G2_Ndist_spread <- spread(G2_NS, key = Gene, value = Nmedian)
## Correlation matrix - r and p
res2 <- rcorr(as.matrix(N_G2_Ndist_spread[,c(3:10)]))
G2_NS_Cor <- flattenCorrMatrix(res2$r, res2$P)
colnames(G2_NS_Cor) <- c("Gene1", "Gene2", "Correlation", "p")
G2_NS_Cor <- G2_NS_Cor %>%
filter(Correlation != 1 & p < 0.05)
G2_NS_Cor$GenePair <- paste(G2_NS_Cor$Gene1, "-", G2_NS_Cor$Gene2)
G2_NS_Cor %>%
ggplot(aes(x=reorder(GenePair, Correlation), y=Correlation)) +
geom_bar(stat = "identity") +
geom_hline(yintercept= 0.3, linetype=4, color='gray', size=0.75) +
geom_hline(yintercept= -0.3, linetype=4, color='gray', size=0.75) +
geom_hline(yintercept= 0.6, linetype=3, color='orange2', size=1) +
geom_hline(yintercept= -0.6, linetype=3, color='orange2', size=1) +
ylim(-1,1) +
xlab("Gene Pair") +
coord_flip() +
theme_bw()
## Filter Corr > 0.3 ##
G2_NS_Cor_03 <- G2_NS_Cor %>%
filter(Correlation >= 0.3)
actors <- data.frame(name=c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
relations <- data.frame(from= G2_NS_Cor_03$Gene1,
to= G2_NS_Cor_03$Gene2,
weight = G2_NS_Cor_03$Correlation)
g <- graph_from_data_frame(relations, directed=F, vertices=actors)
E(g)$width <- E(g)$weight*2.5^2
E(g)[E(g)$weight >= 0.3 & E(g)$weight < 0.595]$color <- "#ABB2B9"
E(g)[E(g)$weight >= 0.595]$color <- "#F5B041"
plot(g, vertex.size=30, vertex.color=GeneCol, vertex.label.color="black", vertex.label.family = "sans",
vertex.frame.width = 0.75)
AllG_NS_V3 %>%
ggplot() +
geom_jitter(aes(x= DomExtVac2_F, y= Nmedian), width = 0.25, size = 0.50, color = "gray40") +
geom_boxplot(aes(x= DomExtVac2_F, y = Nmedian, color = DomExtVac2_F), size = 1.1, outlier.shape = NA, alpha = 0) +
xlab("Dominance") +
ylab("Nonsynonymous genetic distance")+
facet_wrap( ~ Gene, nrow = 2, ncol = 4) +
scale_color_manual(values = VP3Col2, guide="none") +
theme_bw() +
theme(strip.background = element_rect(fill="white"),
strip.text.x = element_text(size = 10, face = "bold", family = "sans"))
plot(g, vertex.size=30, vertex.color=GeneCol, vertex.label.color="black", vertex.label.family = "sans",
vertex.frame.width = 0.75)
G2_NS_Cor_04 <- G2_NS_Cor %>%
filter(Correlation >= 0.395)
G2_NS_Cor_04 <- G2_NS_Cor %>%
filter(Correlation >= 0.395)
G3_NS_Cor_04 <- G3_NS_Cor %>%
filter(Correlation >= 0.395)
G4_NS_Cor_04 <- G5_NS_Cor %>%
filter(Correlation >= 0.395)
G5_NS_Cor_04 <- G5_NS_Cor %>%
filter(Correlation >= 0.395)
G6_NS_Cor_04 <- G6_NS_Cor %>%
filter(Correlation >= 0.395)
G7_NS_Cor_04 <- G7_NS_Cor %>%
filter(Correlation >= 0.395)
G8_NS_Cor_04 <- G8_NS_Cor %>%
filter(Correlation >= 0.395)
G9_NS_Cor_04 <- G9_NS_Cor %>%
filter(Correlation >= 0.395)
G2_NS_Cor_04$Group <- "G2"
G2_NS_Cor_04$Group <- "G2"
G3_NS_Cor_04$Group <- "G3"
G4_NS_Cor_04$Group <- "G4"
G5_NS_Cor_04$Group <- "G5"
G6_NS_Cor_04$Group <- "G6"
G7_NS_Cor_04$Group <- "G7"
G8_NS_Cor_04$Group <- "G8"
G9_NS_Cor_04$Group <- "G9"
AllGenepair_N_Cor_04 <- rbind(G2_NS_Cor_04, G2_NS_Cor_04,
G3_NS_Cor_04, G4_NS_Cor_04,
G5_NS_Cor_04, G6_NS_Cor_04,
G7_NS_Cor_04, G8_NS_Cor_04,
G9_NS_Cor_04)
AllGenepair_N_Cor_04 <- AllGenepair_N_Cor_04[complete.cases(AllGenepair_N_Cor_04), ]
AllGenepair_N_Cor_04[order(AllGenepair_N_Cor_04$GenePair),]
n <- AllGenepair_N_Cor_04 %>%
group_by(GenePair) %>%
summarise(n = n()) %>%
arrange(-n)
GenePairRank <- data.frame(n)
GenePairRank$Pair <- GenePairRank$GenePair
GenePairRank_2 <- GenePairRank %>%
separate(col = Pair, into = c("Gene1", "Gene2"), sep = " - ")
actors <- data.frame(name=c("PB2", "PB1", "PA", "HA",
"NP", "NA", "M", "NS"))
relations <- data.frame(from= GenePairRank_2$Gene1,
to= GenePairRank_2$Gene2,
weight = GenePairRank_2$n)
g <- graph_from_data_frame(relations, directed=F, vertices=actors)
E(g)$width <- E(g)$weight^1.25
E(g)[E(g)$weight >= 5]$color <- "#873600"
E(g)[E(g)$weight >= 3 & E(g)$weight < 5 ]$color <- "#F5B041"
E(g)[E(g)$weight < 3]$color <- "#ABB2B9"
plot(g, vertex.size=30, vertex.color=GeneCol, vertex.label.color="black", vertex.label.family = "sans",
vertex.frame.width = 0.75)
# --- 네가 이미 만든 속성 유지 ---
# E(g)$width <- E(g)$weight^1.25
# E(g)[E(g)$weight >= 5]$color <- "#873600"
# E(g)[E(g)$weight >= 3 & E(g)$weight < 5 ]$color <- "#F5B041"
# E(g)[E(g)$weight < 3]$color <- "#ABB2B9"
# 1) 범례에 쓸 "대표 weight"와 해당 라인 두께(네 맵핑과 동일한 지수)
w_rep      <- c(2, 4, 6)                 # <3, 3–4, ≥5 를 대표하는 weight
lwd_legend <- w_rep^1.25                 # 너의 width 변환과 동일
# 2) 색상과 라벨 (네 기준과 동일)
col_legend <- c("#ABB2B9", "#F5B041", "#873600")
lab_legend <- c("< 3", "3–4", "≥ 5")
# 3) 그래프 먼저 그린 뒤 legend 추가
plot(g,
vertex.size = 30,
vertex.color = GeneCol,
vertex.label.color = "black",
vertex.label.family = "sans",
vertex.frame.width = 0.75)
# 엣지 범례 (색+두께를 동시에 표현)
legend("topleft",
inset = 0.02,
title = "Edge frequency",
legend = lab_legend,
col    = col_legend,
lwd    = lwd_legend,   # 두께 일치
seg.len = 3,
bty = "n")
# (선택) 노드 색 범례: GeneCol이 named vector일 때
# 예: GeneCol <- c(PB2="#...", PB1="#...", ..., NS="#...")
legend("bottomleft",
inset = 0.02,
title = "Gene segment",
legend = actors$name,
pt.bg  = GeneCol[actors$name],
pch = 21, pt.cex = 1.4,
bty = "n")
E(g)[E(g)$weight >= 5]$color <- "#873600"
E(g)[E(g)$weight >= 3 & E(g)$weight < 5 ]$color <- "#F5B041"
E(g)[E(g)$weight < 3]$color <- "#ABB2B9"
w_rep      <- c(2, 4, 6)
lwd_legend <- w_rep^1.25
col_legend <- c("#ABB2B9", "#F5B041", "#873600")
lab_legend <- c("< 3", "3–5", "≥ 5")
plot(g,
vertex.size = 30,
vertex.color = GeneCol,
vertex.label.color = "black",
vertex.label.family = "sans",
vertex.frame.width = 0.75)
legend("topleft",
inset = 0.02,
title = "Edge frequency",
legend = lab_legend,
col    = col_legend,
lwd    = lwd_legend,
seg.len = 3,
bty = "n")
plot(g,
vertex.size = 30,
vertex.color = GeneCol,
vertex.label.color = "black",
vertex.label.family = "sans",
vertex.frame.width = 0.75)
legend("topleft",
inset = 0.02,
title = "Edge frequency",
legend = lab_legend,
col    = col_legend,
lwd    = lwd_legend,
seg.len = 3,
bty = "n")
### Seasonal H3N2 Prediction - N and S Genetic distance - Difference between two vaccine group ###
## Package ##
library(tidyverse)
library(ggridges)
library(RColorBrewer)
## Set working directory ##
#setwd("C:/Users/KU_Microb_Virus/gDrive/KU_RschProf/01_GenDisFlu/")
setwd("/Users/sangyi/Desktop/H3N2/1_Data/10_Final_MetaData_Submission")
## Data import ##
AllG_NS <- read.csv('H3N2_Traindata_600strains_2_NonsynDist.csv')
AllG_NS <- AllG_NS %>%
pivot_longer(
cols = ends_with("_Nonsyn"),
names_to = "Gene",
values_to = "Nmedian"
) %>%
mutate(
Gene = gsub("_Nonsyn", "", Gene)  # Gene 이름 정리
)
GeneCol <- c("#C780E8", "#9D94FF","#59ADF6","#08CAD1","#42D6A4","#F8F38D","#FFB480","#FF6961")
## Subset list
Subsetlist <- read.csv("/Users/sangyi/Desktop/H3N2/1_Data/2_RNSC/1_MetaData/1_Before2020_601/H3N2_Index_20230331.csv")
colnames(Subsetlist)[1] <- 'StrainName'
AllG_NS_V2 <- right_join(AllG_NS, Subsetlist)
VacCoCol <- c("#716172","#EFA95F","#3EA3C5","#6D9431","#800000","#9E6D13","#092E50","#769F74","#954495")
AllG_NS_V2$vaccineStrain_F <- factor(AllG_NS_V2$vaccineStrain,
levels = c("EPI103320_A_Moscow_10_1999",
"EPI358781_A_Fujian_411_2002",
"EPI367109_A_California_7_2004",
"EPI502253_A_Wisconsin_67_2005",
"EPI577980_A_Brisbane_10_2007",
"EPI577969_A_Perth_16_2009",
"EPI417234_A_Victoria_361_2011",
"EPI614441_A_Switzerland_9715293_2013"),
labels = c("1.Mos99 vs 2.Fuj02",
"2.Fuj02 vs 3.Cal04",
"3.Cal04 vs 4.Wis05",
"4.Wis05 vs 5.Bris07",
"5.Bris07 vs 6.Prth09",
"6.Prth09 vs 7.Vic11",
"7.Vic11 vs 8.Swtz13",
"8.Swtz13 vs 9. HK15"))
AllG_NS_V2$vaccine_period_Bi <- ifelse(AllG_NS_V2$vaccineStrain == "EPI103320_A_Moscow_10_1999" & AllG_NS_V2$vaccine_code == "Fuj02", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI358781_A_Fujian_411_2002" & AllG_NS_V2$vaccine_code == "Cal04", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI367109_A_California_7_2004" & AllG_NS_V2$vaccine_code == "Wis05", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI502253_A_Wisconsin_67_2005" & AllG_NS_V2$vaccine_code == "Bris07", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI577980_A_Brisbane_10_2007" & AllG_NS_V2$vaccine_code == "Prth09", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI577969_A_Perth_16_2009" & AllG_NS_V2$vaccine_code == "Vic11", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI417234_A_Victoria_361_2011" & AllG_NS_V2$vaccine_code == "Swtz13", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI614441_A_Switzerland_9715293_2013" & AllG_NS_V2$vaccine_code == "HK15", "VP+1","VP"
))))))))
AllG_NS_V2$DomExtVac2_F <- factor(AllG_NS_V2$vaccine_period_Bi,
levels = c("VP","VP+1"), labels = c("Before update","After update"))
VP3Col <- c("#000000","#96fd29")
## Load dominant file
Dom <- read.csv("/Users/sangyi/Desktop/H3N2/1_Data/5_Regression/Dom.csv")
subdata <- Dom[,c(1,16)]
colnames(subdata)[1] <- "StrainName"
AllG_NS_V3 <- left_join(AllG_NS_V2, subdata, by = "StrainName")
AllG_NS_V3$DomExtVac2 <- ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 0, 0,
ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 1, 1, 2))
AllG_NS_V3$DomExtVac2_F <- factor(AllG_NS_V3$DomExtVac2,
levels = c(0,1,2),
labels = c("Extinct","Dominant","After Vaccine"))
VP3Col2 <- c("#000000","#96fd29","#999900")
### Fina box plot ###
#
# jpeg(filename = "C:/Users/KU_Microb_Virus/OneDrive - 고려대학교/RschProf_KU/01_GenDisFlu/Fig/Desc/NS_3VacPrd/Box_8gene.jpeg", width = 220, height = 200, units = "mm", res = 450)
# svg(filename = "Fig/Desc/NS_2VacPrd/gene_Dom_2nd.svg", width = 11, height = 10)
AllG_NS_V3 <- AllG_NS_V3[!is.na(AllG_NS_V3$Gene),]
AllG_NS_V3 %>%
ggplot() +
geom_jitter(aes(x= DomExtVac2_F, y= Nmedian), width = 0.25, size = 0.50, color = "gray40") +
geom_boxplot(aes(x= DomExtVac2_F, y = Nmedian, color = DomExtVac2_F), size = 1.1, outlier.shape = NA, alpha = 0) +
xlab("Dominance") +
ylab("Nonsynonymous genetic distance")+
facet_wrap( ~ Gene, nrow = 2, ncol = 4) +
scale_color_manual(values = VP3Col2, guide="none") +
theme_bw() +
theme(strip.background = element_rect(fill="white"),
strip.text.x = element_text(size = 10, face = "bold", family = "sans"))
AllG_NS_V3 %>%
ggplot() +
geom_jitter(aes(x= DomExtVac2_F, y= Nmedian), width = 0.25, size = 0.50, color = "gray40") +
geom_boxplot(aes(x= DomExtVac2_F, y = Nmedian, color = DomExtVac2_F), size = 1.1, outlier.shape = NA, alpha = 0) +
xlab("Dominance") +
ylab("Nonsynonymous genetic distance")+
facet_wrap( ~ Gene, nrow = 2, ncol = 4) +
scale_color_manual(values = VP3Col2, guide="none") +
theme_bw() +
theme(strip.background = element_rect(fill="white"),
strip.text.x = element_text(size = 10, face = "bold", family = "sans"))
### Seasonal H3N2 Prediction - N and S Genetic distance - Difference between two vaccine group ###
## Package ##
library(tidyverse)
library(ggridges)
library(RColorBrewer)
## Set working directory ##
#setwd("C:/Users/KU_Microb_Virus/gDrive/KU_RschProf/01_GenDisFlu/")
setwd("/Users/sangyi/Desktop/H3N2/1_Data/10_Final_MetaData_Submission")
## Data import ##
AllG_NS <- read.csv('H3N2_Traindata_600strains_2_NonsynDist.csv')
AllG_NS <- AllG_NS %>%
pivot_longer(
cols = ends_with("_Nonsyn"),
names_to = "Gene",
values_to = "Nmedian"
) %>%
mutate(
Gene = gsub("_Nonsyn", "", Gene)  # Gene 이름 정리
)
GeneCol <- c("#C780E8", "#9D94FF","#59ADF6","#08CAD1","#42D6A4","#F8F38D","#FFB480","#FF6961")
## Subset list
Subsetlist <- read.csv("/Users/sangyi/Desktop/H3N2/1_Data/2_RNSC/1_MetaData/1_Before2020_601/H3N2_Index_20230331.csv")
colnames(Subsetlist)[1] <- 'StrainName'
AllG_NS_V2 <- right_join(AllG_NS, Subsetlist)
VacCoCol <- c("#716172","#EFA95F","#3EA3C5","#6D9431","#800000","#9E6D13","#092E50","#769F74","#954495")
AllG_NS_V2$vaccineStrain_F <- factor(AllG_NS_V2$vaccineStrain,
levels = c("EPI103320_A_Moscow_10_1999",
"EPI358781_A_Fujian_411_2002",
"EPI367109_A_California_7_2004",
"EPI502253_A_Wisconsin_67_2005",
"EPI577980_A_Brisbane_10_2007",
"EPI577969_A_Perth_16_2009",
"EPI417234_A_Victoria_361_2011",
"EPI614441_A_Switzerland_9715293_2013"),
labels = c("1.Mos99 vs 2.Fuj02",
"2.Fuj02 vs 3.Cal04",
"3.Cal04 vs 4.Wis05",
"4.Wis05 vs 5.Bris07",
"5.Bris07 vs 6.Prth09",
"6.Prth09 vs 7.Vic11",
"7.Vic11 vs 8.Swtz13",
"8.Swtz13 vs 9. HK15"))
AllG_NS_V2$vaccine_period_Bi <- ifelse(AllG_NS_V2$vaccineStrain == "EPI103320_A_Moscow_10_1999" & AllG_NS_V2$vaccine_code == "Fuj02", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI358781_A_Fujian_411_2002" & AllG_NS_V2$vaccine_code == "Cal04", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI367109_A_California_7_2004" & AllG_NS_V2$vaccine_code == "Wis05", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI502253_A_Wisconsin_67_2005" & AllG_NS_V2$vaccine_code == "Bris07", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI577980_A_Brisbane_10_2007" & AllG_NS_V2$vaccine_code == "Prth09", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI577969_A_Perth_16_2009" & AllG_NS_V2$vaccine_code == "Vic11", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI417234_A_Victoria_361_2011" & AllG_NS_V2$vaccine_code == "Swtz13", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI614441_A_Switzerland_9715293_2013" & AllG_NS_V2$vaccine_code == "HK15", "VP+1","VP"
))))))))
AllG_NS_V2$DomExtVac2_F <- factor(AllG_NS_V2$vaccine_period_Bi,
levels = c("VP","VP+1"), labels = c("Before update","After update"))
VP3Col <- c("#000000","#96fd29")
## Load dominant file
Dom <- read.csv("/Users/sangyi/Desktop/H3N2/1_Data/5_Regression/Dom.csv")
subdata <- Dom[,c(1,16)]
colnames(subdata)[1] <- "StrainName"
AllG_NS_V3 <- left_join(AllG_NS_V2, subdata, by = "StrainName")
AllG_NS_V3$DomExtVac2 <- ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 0, 0,
ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 1, 1, 2))
AllG_NS_V3$DomExtVac2_F <- factor(AllG_NS_V3$DomExtVac2,
levels = c(0,1,2),
labels = c("Extinct","Dominant","After Vaccine"))
VP3Col2 <- c("#000000","#96fd29","#999900")
### Fina box plot ###
#
# jpeg(filename = "C:/Users/KU_Microb_Virus/OneDrive - 고려대학교/RschProf_KU/01_GenDisFlu/Fig/Desc/NS_3VacPrd/Box_8gene.jpeg", width = 220, height = 200, units = "mm", res = 450)
# svg(filename = "Fig/Desc/NS_2VacPrd/gene_Dom_2nd.svg", width = 11, height = 10)
AllG_NS_V3 <- AllG_NS_V3[!is.na(AllG_NS_V3$Gene),]
AllG_NS_V3 %>%
ggplot() +
geom_jitter(aes(x= DomExtVac2_F, y= Nmedian), width = 0.25, size = 0.50, color = "gray40") +
geom_boxplot(aes(x= DomExtVac2_F, y = Nmedian, color = DomExtVac2_F), size = 1.1, outlier.shape = NA, alpha = 0) +
xlab("Dominance") +
ylab("Nonsynonymous genetic distance")+
facet_wrap( ~ Gene, nrow = 2, ncol = 4) +
scale_color_manual(values = VP3Col2, guide="none") +
theme_bw() +
theme(strip.background = element_rect(fill="white"),
strip.text.x = element_text(size = 10, face = "bold", family = "sans"))
### Seasonal H3N2 Prediction - N and S Genetic distance - Difference between two vaccine group ###
## Package ##
library(tidyverse)
library(ggridges)
library(RColorBrewer)
## Set working directory ##
setwd("/Users/sangyi/Desktop/H3N2/1_Data/10_Final_MetaData_Submission")
## Data import ##
AllG_NS <- read.csv('H3N2_Traindata_600strains_2_NonsynDist.csv')
AllG_NS <- AllG_NS %>%
pivot_longer(
cols = ends_with("_Nonsyn"),
names_to = "Gene",
values_to = "Nmedian"
) %>%
mutate(
Gene = gsub("_Nonsyn", "", Gene)  # Gene 이름 정리
)
GeneCol <- c("#C780E8", "#9D94FF","#59ADF6","#08CAD1","#42D6A4","#F8F38D","#FFB480","#FF6961")
## Subset list
Subsetlist <- read.csv("/Users/sangyi/Desktop/H3N2/1_Data/2_RNSC/1_MetaData/1_Before2020_601/H3N2_Index_20230331.csv")
colnames(Subsetlist)[1] <- 'StrainName'
AllG_NS_V2 <- right_join(AllG_NS, Subsetlist)
VacCoCol <- c("#716172","#EFA95F","#3EA3C5","#6D9431","#800000","#9E6D13","#092E50","#769F74","#954495")
AllG_NS_V2$vaccineStrain_F <- factor(AllG_NS_V2$vaccineStrain,
levels = c("EPI103320_A_Moscow_10_1999",
"EPI358781_A_Fujian_411_2002",
"EPI367109_A_California_7_2004",
"EPI502253_A_Wisconsin_67_2005",
"EPI577980_A_Brisbane_10_2007",
"EPI577969_A_Perth_16_2009",
"EPI417234_A_Victoria_361_2011",
"EPI614441_A_Switzerland_9715293_2013"),
labels = c("1.Mos99 vs 2.Fuj02",
"2.Fuj02 vs 3.Cal04",
"3.Cal04 vs 4.Wis05",
"4.Wis05 vs 5.Bris07",
"5.Bris07 vs 6.Prth09",
"6.Prth09 vs 7.Vic11",
"7.Vic11 vs 8.Swtz13",
"8.Swtz13 vs 9. HK15"))
AllG_NS_V2$vaccine_period_Bi <- ifelse(AllG_NS_V2$vaccineStrain == "EPI103320_A_Moscow_10_1999" & AllG_NS_V2$vaccine_code == "Fuj02", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI358781_A_Fujian_411_2002" & AllG_NS_V2$vaccine_code == "Cal04", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI367109_A_California_7_2004" & AllG_NS_V2$vaccine_code == "Wis05", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI502253_A_Wisconsin_67_2005" & AllG_NS_V2$vaccine_code == "Bris07", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI577980_A_Brisbane_10_2007" & AllG_NS_V2$vaccine_code == "Prth09", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI577969_A_Perth_16_2009" & AllG_NS_V2$vaccine_code == "Vic11", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI417234_A_Victoria_361_2011" & AllG_NS_V2$vaccine_code == "Swtz13", "VP+1",
ifelse(AllG_NS_V2$vaccineStrain == "EPI614441_A_Switzerland_9715293_2013" & AllG_NS_V2$vaccine_code == "HK15", "VP+1","VP"
))))))))
AllG_NS_V2$DomExtVac2_F <- factor(AllG_NS_V2$vaccine_period_Bi,
levels = c("VP","VP+1"), labels = c("Before update","After update"))
VP3Col <- c("#000000","#96fd29")
## Load dominant file
Dom <- read.csv("/Users/sangyi/Desktop/H3N2/1_Data/5_Regression/Dom.csv")
subdata <- Dom[,c(1,16)]
colnames(subdata)[1] <- "StrainName"
AllG_NS_V3 <- left_join(AllG_NS_V2, subdata, by = "StrainName")
AllG_NS_V3$DomExtVac2 <- ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 0, 0,
ifelse(AllG_NS_V3$vaccine_period_Bi == "VP" & AllG_NS_V3$subtMRCA_1stDesc == 1, 1, 2))
AllG_NS_V3$DomExtVac2_F <- factor(AllG_NS_V3$DomExtVac2,
levels = c(0,1,2),
labels = c("Extinct","Dominant","After Vaccine"))
VP3Col2 <- c("#000000","#96fd29","#999900")
AllG_NS_V3 <- AllG_NS_V3[!is.na(AllG_NS_V3$Gene),]
AllG_NS_V3 %>%
ggplot() +
geom_jitter(aes(x= DomExtVac2_F, y= Nmedian), width = 0.25, size = 0.50, color = "gray40") +
geom_boxplot(aes(x= DomExtVac2_F, y = Nmedian, color = DomExtVac2_F), size = 1.1, outlier.shape = NA, alpha = 0) +
xlab("Dominance") +
ylab("Nonsynonymous genetic distance")+
facet_wrap( ~ Gene, nrow = 2, ncol = 4) +
scale_color_manual(values = VP3Col2, guide="none") +
theme_bw() +
theme(strip.background = element_rect(fill="white"),
strip.text.x = element_text(size = 10, face = "bold", family = "sans"))
